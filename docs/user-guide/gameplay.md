# 游戏操作说明

## 游戏准备

### 1. 系统启动检查

在开始游戏前，请确保所有系统组件正常运行：

```bash
# 检查系统状态
docker-compose ps

# 确认所有服务都是 Up 状态：
# ✅ chess_robot_mongodb      Up
# ✅ chess_robot_redis        Up
# ✅ chess_robot_web_gateway  Up
# ✅ chess_robot_ai_engine    Up
# ✅ chess_robot_vision       Up
# ✅ chess_robot_controller   Up
```

### 2. 硬件连接验证

#### 深度相机检查
- 访问 `http://localhost:3000/calibration`
- 查看相机预览画面是否正常
- 确认图像清晰，无马赛克或黑屏

#### 机械臂检查
- 机械臂应处于初始位置
- LED指示灯为绿色（正常）或蓝色（待机）
- 关节无异响，运动平稳

#### 棋盘和棋子准备
- 使用标准64格国际象棋棋盘
- 棋子摆放在初始位置
- 确保棋盘在相机视野范围内
- 光照条件良好，避免强烈阴影

### 3. 系统标定

如果是首次使用或硬件位置有变动，需要重新标定：

```bash
# 进入标定页面
http://localhost:3000/calibration

# 按照界面指引完成：
1. 相机标定 (约3-5分钟)
2. 机械臂标定 (约5-10分钟)
3. 坐标映射标定 (约2-3分钟)
```

## 开始新游戏

### 1. 创建游戏

1. 访问主界面：`http://localhost:3000`
2. 点击 **"新游戏"** 按钮
3. 选择游戏难度：

```
难度等级说明：
┌─────────┬────────────┬──────────────┐
│ 等级    │ AI强度      │ 适合对象      │
├─────────┼────────────┼──────────────┤
│ 1-3     │ 初学者     │ 象棋新手      │
│ 4-6     │ 业余爱好者  │ 有一定基础    │
│ 7-10    │ 俱乐部水平  │ 经验丰富      │
│ 11-15   │ 大师水平    │ 高手对弈      │
│ 16-20   │ 世界冠军级  │ 极限挑战      │
└─────────┴────────────┴──────────────┘
```

4. 设置思考时间限制：
   - **5秒**: 快节奏游戏
   - **10秒**: 标准模式
   - **30秒**: 深度思考
   - **无限制**: 不限时间

5. 选择玩家执棋颜色：
   - **白棋先行**: 玩家执白子，先移动
   - **黑棋后手**: 玩家执黑子，AI先移动

### 2. 游戏界面介绍

```
┌─────────────────────────────────────────────────────────┐
│ 智能象棋机器人 - 游戏中                                  │
├─────────────────────┬───────────────────────────────────┤
│                     │ 🎮 游戏控制                       │
│                     │ ⏸️ 暂停  🔄 悔棋  ⏹️ 结束         │
│     3D 棋盘         │                                  │
│                     │ 📊 当前状态                       │
│                     │ 轮次: 玩家回合                    │
│                     │ 移动: 15手                       │
│                     │                                  │
│                     │ ⏱️ 用时统计                       │
│                     │ 玩家: 05:23                      │
│                     │ AI: 03:47                        │
│                     │                                  │
│                     │ 📝 移动历史                       │
│                     │ 14. e4   e5                      │
│                     │ 15. Nf3  ...                     │
├─────────────────────┴───────────────────────────────────┤
│ 💬 系统消息: 请移动您的棋子，系统正在监听...              │
└─────────────────────────────────────────────────────────┘
```

## 游戏流程

### 1. 玩家移动

#### 标准移动流程
1. **思考并决定移动**: 在物理棋盘上思考下一步
2. **执行物理移动**: 用手移动真实的棋子
3. **等待系统识别**: 系统会自动检测移动
4. **确认移动**: 界面显示检测到的移动

#### 移动检测过程
```
🔍 检测阶段说明：

1. [扫描中] 相机拍摄当前棋盘状态
2. [分析中] AI算法识别变化的位置
3. [验证中] 检查移动是否符合象棋规则
4. [确认中] 将移动同步到3D界面
5. [完成  ] 移动记录到游戏历史
```

#### 处理特殊情况

**兵的升变**
- 当兵到达底线时，系统会询问升变选择
- 默认升变为皇后，可手动选择其他棋子

**王车易位**
- 同时移动国王和车到正确位置
- 系统会自动识别为易位操作

**吃过路兵**
- 先移动己方兵，再移除对方的过路兵
- 系统会根据规则自动处理

### 2. AI移动

#### AI思考过程
```
🧠 AI决策流程：

1. [接收中] 获取当前棋盘状态
2. [搜索中] Stockfish引擎深度搜索
3. [评估中] 评估各种可能的移动
4. [选择中] 选择最佳移动策略
5. [执行中] 发送指令给机械臂
```

#### 机械臂执行
```
🦾 机械臂操作流程：

1. [规划中] 计算移动轨迹和路径
2. [移动中] 机械臂移动到起始位置
3. [抓取中] 夹爪抓取目标棋子
4. [运输中] 将棋子移动到目标位置
5. [放置中] 将棋子准确放置
6. [复位中] 机械臂返回待机位置
```

### 3. 游戏状态监控

#### 实时状态指示器
- **🟢 正常**: 所有系统运行正常
- **🟡 忙碌**: 系统正在处理操作
- **🔴 异常**: 检测到错误或异常
- **⏸️ 暂停**: 游戏已暂停

#### 性能监控
```
📊 系统性能实时显示：
┌─────────────────────────────────────┐
│ 🖥️ CPU: ████░░░░░░ 42%              │
│ 💾 内存: ████████░░ 78%              │
│ 🎮 GPU: ████████░░ 76%               │
│ 🌡️ 温度: 64°C                       │
│                                    │
│ 📸 相机FPS: 28                       │
│ 🦾 臂延迟: 120ms                     │
│ 🧠 AI响应: 2.3s                     │
└─────────────────────────────────────┘
```

## 游戏操作功能

### 1. 基础操作

#### 暂停游戏
- **用途**: 临时停止游戏进程
- **操作**: 点击"⏸️暂停"按钮
- **效果**:
  - 停止移动检测
  - 暂停计时器
  - AI停止思考
- **恢复**: 点击"▶️继续"按钮

#### 悔棋功能
- **限制**: 每局游戏最多悔棋3次
- **操作**: 点击"🔄悔棋"按钮
- **效果**: 撤销最近一步移动
- **注意**: 需要手动将物理棋子复位

#### 结束游戏
- **操作**: 点击"⏹️结束"按钮
- **确认**: 系统会要求确认操作
- **保存**: 自动保存游戏记录和统计

### 2. 高级功能

#### 移动提示
```javascript
// 启用/关闭移动提示
设置 > 游戏辅助 > 移动提示: [开启/关闭]

功能说明：
- 高亮显示可移动的棋子
- 显示合法移动位置
- 标记危险区域
- 提示最佳移动建议
```

#### 游戏分析
```
📈 实时分析功能：

- 局面评估: +0.5 (略微领先)
- 移动质量: 85分 (优秀移动)
- 最佳变着: Be5+ Kg8 Bxf6
- 时间分配: 建议加快节奏
```

#### 自动保存
- **默认**: 每5步自动保存
- **手动**: Ctrl+S 快捷键保存
- **位置**: 游戏记录存储在MongoDB中

### 3. 错误处理

#### 移动识别错误
```
❌ 常见问题及解决：

1. "无法识别移动"
   - 检查棋子是否完全放置到位
   - 确认只移动了一个棋子
   - 改善光照条件

2. "移动不符合规则"
   - 检查是否按象棋规则移动
   - 确认没有自我将军
   - 验证特殊移动的完整性

3. "检测到多个变化"
   - 确保只移动目标棋子
   - 检查是否误碰其他棋子
   - 等待系统重新扫描
```

#### 系统异常处理
```
🔧 故障排除步骤：

1. 硬件连接问题：
   - 检查相机USB连接
   - 验证机械臂电源和串口
   - 重新启动相关服务

2. 性能问题：
   - 检查系统资源使用
   - 关闭不必要的程序
   - 降低AI难度等级

3. 网络问题：
   - 刷新浏览器页面
   - 检查WebSocket连接
   - 重启Docker服务
```

## 游戏结束

### 1. 游戏终局

#### 胜负判定
- **将死**: 国王被将军且无法逃脱
- **和棋**: 僵局、50步规则、三次重复
- **投降**: 玩家主动认输
- **超时**: 超过时间限制（如果设置）

#### 结果显示
```
🏆 游戏结果：

┌─────────────────────────────────────┐
│ 🎉 游戏结束                          │
├─────────────────────────────────────┤
│ 结果: 玩家获胜 (将死)                │
│ 用时: 玩家 12:34, AI 08:56           │
│ 移动: 总共 47 手                     │
│ 评分: ★★★★☆ (优秀对弈)               │
│                                    │
│ [查看棋谱] [再来一局] [保存游戏]      │
└─────────────────────────────────────┘
```

### 2. 游戏统计

#### 个人统计
- **胜率**: 与不同难度AI的胜负记录
- **平均用时**: 每步棋的平均思考时间
- **游戏时长**: 完整对局的平均时间
- **进步趋势**: 棋力水平变化图表

#### 详细分析
```
📊 本局详细统计：

开局阶段 (1-10手):
- 用时: 3:24 (20.4秒/手)
- 质量: 92% (优秀)
- 理论值: +0.2

中局阶段 (11-30手):
- 用时: 6:45 (20.25秒/手)
- 质量: 87% (良好)
- 理论值: -0.1

残局阶段 (31-47手):
- 用时: 2:25 (8.5秒/手)
- 质量: 94% (优秀)
- 理论值: +1.5
```

### 3. 游戏回顾

#### 棋谱导出
```bash
# 支持多种格式导出
- PGN格式: 标准象棋记谱
- FEN格式: 位置记录
- JSON格式: 完整游戏数据
- PDF格式: 图文并茂的棋谱
```

#### 复盘功能
- **自动复盘**: 按移动顺序重播
- **手动控制**: 逐步前进/后退
- **关键时刻**: 跳转到重要决策点
- **变着分析**: 显示替代方案

## 高级游戏模式

### 1. 训练模式
- **残局练习**: 专门的残局训练
- **开局学习**: 常见开局套路练习
- **战术训练**: 战术组合题练习

### 2. 对战模式
- **人人对战**: 两个玩家对弈
- **联网对战**: 远程玩家对弈
- **比赛模式**: 正式比赛规则

### 3. 分析模式
- **深度分析**: 引擎深度分析每个位置
- **多变着**: 显示多个最佳移动选项
- **实时指导**: 提供移动建议和解释

## 游戏礼仪

### 1. 操作规范
- 移动棋子要轻柔，避免震动棋盘
- 确保棋子完全放置在格子中心
- 不要同时移动多个棋子
- 等待系统识别完成再进行下一步

### 2. 设备保护
- 保持相机镜头清洁
- 避免遮挡相机视野
- 轻柔操作机械臂紧急停止按钮
- 定期检查设备连接状态

### 3. 安全注意
- 机械臂运行时保持安全距离
- 发现异常立即暂停游戏
- 定期保存游戏进度
- 注意系统温度，适时休息