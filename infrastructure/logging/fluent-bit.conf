[SERVICE]
    Flush         5
    Daemon        off
    Log_Level     info
    Parsers_File  parsers.conf
    HTTP_Server   On
    HTTP_Listen   0.0.0.0
    HTTP_Port     2020
    Health_Check  On

# 读取象棋机器人服务日志文件
[INPUT]
    Name              tail
    Path              /var/log/chess/*.log
    Exclude_Path      /var/log/chess/*.log.*
    Parser            chess_json
    Tag               chess.*
    Refresh_Interval  5
    Mem_Buf_Limit     50MB
    Skip_Long_Lines   On
    Skip_Empty_Lines  On

# 读取Docker容器日志
[INPUT]
    Name              forward
    Listen            0.0.0.0
    Port              24224
    Tag               docker.*

# 系统指标收集
[INPUT]
    Name              cpu
    Tag               system.cpu
    Interval_Sec      10

[INPUT]
    Name              mem
    Tag               system.memory
    Interval_Sec      10

[INPUT]
    Name              disk
    Tag               system.disk
    Interval_Sec      30
    Path              /

# 处理和过滤规则
[FILTER]
    Name              modify
    Match             chess.*
    Add               system chess_robot
    Add               environment production

[FILTER]
    Name              parser
    Match             docker.*
    Key_Name          log
    Parser            docker_json
    Reserve_Data      On
    Preserve_Key      On

# 添加Kubernetes元数据（如果在K8s环境中）
#[FILTER]
#    Name                kubernetes
#    Match               kube.*
#    Kube_URL            https://kubernetes.default.svc:443
#    Kube_CA_File        /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
#    Kube_Token_File     /var/run/secrets/kubernetes.io/serviceaccount/token
#    Merge_Log           On
#    K8S-Logging.Parser  On
#    K8S-Logging.Exclude Off

# 输出到Elasticsearch
[OUTPUT]
    Name              es
    Match             chess.*
    Host              ${FLB_ES_HOST}
    Port              ${FLB_ES_PORT}
    Index             chess-logs
    Type              _doc
    Logstash_Format   On
    Logstash_Prefix   chess
    Logstash_DateFormat %Y.%m.%d
    Time_Key          @timestamp
    Time_Key_Format   %Y-%m-%dT%H:%M:%S.%L
    Include_Tag_Key   On
    Tag_Key           fluent_tag
    Retry_Limit       5
    Suppress_Type_Name On

# 输出系统指标到Elasticsearch
[OUTPUT]
    Name              es
    Match             system.*
    Host              ${FLB_ES_HOST}
    Port              ${FLB_ES_PORT}
    Index             chess-metrics
    Type              _doc
    Logstash_Format   On
    Logstash_Prefix   chess-metrics
    Logstash_DateFormat %Y.%m.%d
    Time_Key          @timestamp
    Include_Tag_Key   On
    Tag_Key           fluent_tag
    Retry_Limit       5
    Suppress_Type_Name On

# 输出Docker日志到Elasticsearch
[OUTPUT]
    Name              es
    Match             docker.*
    Host              ${FLB_ES_HOST}
    Port              ${FLB_ES_PORT}
    Index             docker-logs
    Type              _doc
    Logstash_Format   On
    Logstash_Prefix   docker
    Logstash_DateFormat %Y.%m.%d
    Time_Key          @timestamp
    Include_Tag_Key   On
    Tag_Key           fluent_tag
    Retry_Limit       5
    Suppress_Type_Name On

# 调试输出（可选）
#[OUTPUT]
#    Name              stdout
#    Match             *
#    Format            json_lines